var big_img = [
    'http://i2.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/01/01/Cg-4WVWadlGIF0M2AAadFE_d2uoAAGn2AKqXBYABp0s352.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/01/01/Cg-4WlWadkOIXFRNAATR-4BsCyIAAGn2AEljCMABNIT468.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/01/01/Cg-4WlWaeXWIJ795AAkbvP5bCDEAAGn4wPExHMACRvU343.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/06/06/Cg-4WlV3hEiIJxi6AASsDuO7ZiUAAE9PACyKyIABKwm626.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/02/0C/Cg-4WVVynFqIP877AAQ7eApdal8AAEu4QOfyiEABDuQ463.jpg',
    'http://i4.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/02/0C/Cg-4WVVynGmIP8BhAAIzLRfFQi8AAEu4gAORsIAAjNF434.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/02/0C/Cg-4WlVynNuIM9YFAAM79YCnL6oAAEu4wDhbLwAAzwN867.jpg',
    'http://i5.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/02/0C/Cg-4WlVynV6IVo5xAApGjqRL9EMAAEu5AFk1aIACkam665.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/02/0C/Cg-4WVVynXCIQ9mWAAhMsnuErJ4AAEu5AIhDEgACEzK881.jpg',
    'http://i5.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/02/0C/Cg-4WVVynbKIP8kCAAMGDA9wZvsAAEu5QICJasAAwYk625.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s1200x5000/g2/M00/02/0C/Cg-4WVVynb2IEYDtAAXZmKkjRnIAAEu5QJnBJQABdmw507.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s1200x5000/g3/M06/08/05/Cg-4V1Q3mYuIcUXTAA3hXpq5I6oAAP-pQF-aVsADeF2712.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s1200x5000/g1/M01/06/02/Cg-4jlOVMhiIEB0yAArK4ii9W8UAAOIcQGndisACsr6873.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s1200x5000/g3/M05/00/03/Cg-4V1H_6FCIV_20AAdmAckg6I8AAKp6QFb4vAAB2YZ589.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s1200x5000/g3/M03/0F/06/Cg-4V1GxIFyIJ2VZAAixSptQmg4AAJmxwF8-rgACLFi579.jpg',
    'http://i4.bbs.fd.zol-img.com.cn/t_s1200x5000/g3/M03/0F/06/Cg-4WFGxIF-IbIYuAAp6gy7dgLQAAJmxwHmhb4ACnqb404.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s1200x5000/g3/M00/00/03/Cg-4WFH_1xCIFMqMAAav2hHrmyQAAKp5AB90Q0ABq_y038.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s1200x5000/g3/M08/0E/08/Cg-4V1GwMLyIUw0iAAWyHzRbJPUAAJjMAMaEZAABbI3726.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s1200x5000/g4/M08/09/00/Cg-4WVGwLeGIZ9RcAA31LOAnliEAAJjQgIcvZUADfVE446.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s1200x5000/g4/M02/08/0F/Cg-4WVGwGIaIcIGRAASWHl-4LSsAAJi9AL8PsUABJY2917.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s1200x5000/g4/M02/08/0F/Cg-4WlGwGIeIOIWRAANMrMcXPpwAAJi9AMdJPAAA0zE682.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s1200x5000/g5/M00/06/03/ChMkJlgW98yIAvUPABR70e9wXMoAAXV4AL1vuEAFHvp141.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s1200x5000/g5/M00/03/09/ChMkJ1ffe6OIVboSABWPrwnR8ykAAWLWgKCToIAFY_H802.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s1200x5000/g5/M00/03/09/ChMkJ1ffe6eIZDfbABltOoNBfb0AAWLWgKe3SsAGW1S310.jpg'
    ];

var sm_img = [
    'http://i2.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/01/01/Cg-4WVWadlGIF0M2AAadFE_d2uoAAGn2AKqXBYABp0s352.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/01/01/Cg-4WlWadkOIXFRNAATR-4BsCyIAAGn2AEljCMABNIT468.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/01/01/Cg-4WlWaeXWIJ795AAkbvP5bCDEAAGn4wPExHMACRvU343.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/06/06/Cg-4WlV3hEiIJxi6AASsDuO7ZiUAAE9PACyKyIABKwm626.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/02/0C/Cg-4WVVynFqIP877AAQ7eApdal8AAEu4QOfyiEABDuQ463.jpg',
    'http://i4.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/02/0C/Cg-4WVVynGmIP8BhAAIzLRfFQi8AAEu4gAORsIAAjNF434.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/02/0C/Cg-4WlVynNuIM9YFAAM79YCnL6oAAEu4wDhbLwAAzwN867.jpg',
    'http://i5.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/02/0C/Cg-4WlVynV6IVo5xAApGjqRL9EMAAEu5AFk1aIACkam665.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/02/0C/Cg-4WVVynXCIQ9mWAAhMsnuErJ4AAEu5AIhDEgACEzK881.jpg',
    'http://i5.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/02/0C/Cg-4WVVynbKIP8kCAAMGDA9wZvsAAEu5QICJasAAwYk625.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s100x75c4/g2/M00/02/0C/Cg-4WVVynb2IEYDtAAXZmKkjRnIAAEu5QJnBJQABdmw507.jpg',
    'http://i5.bbs.fd.zol-img.com.cn/t_s100x75c4/g3/M06/08/05/Cg-4V1Q3mYOIMmoIAAvdkI2NTxsAAP-pQENPeUAC92o025.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s100x75c4/g1/M01/06/02/Cg-4jlOVMhiIEB0yAArK4ii9W8UAAOIcQGndisACsr6873.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s100x75c4/g3/M05/00/03/Cg-4V1H_6FCIV_20AAdmAckg6I8AAKp6QFb4vAAB2YZ589.jpg',
    'http://i3.bbs.fd.zol-img.com.cn/t_s100x75c4/g3/M03/0F/06/Cg-4V1GxIFyIJ2VZAAixSptQmg4AAJmxwF8-rgACLFi579.jpg',
    'http://i4.bbs.fd.zol-img.com.cn/t_s100x75c4/g3/M03/0F/06/Cg-4WFGxIF-IbIYuAAp6gy7dgLQAAJmxwHmhb4ACnqb404.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s100x75c4/g3/M00/00/03/Cg-4WFH_1xCIFMqMAAav2hHrmyQAAKp5AB90Q0ABq_y038.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s100x75c4/g3/M08/0E/08/Cg-4V1GwMLyIUw0iAAWyHzRbJPUAAJjMAMaEZAABbI3726.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s100x75c4/g4/M08/09/00/Cg-4WVGwLeGIZ9RcAA31LOAnliEAAJjQgIcvZUADfVE446.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s100x75c4/g4/M02/08/0F/Cg-4WVGwGIaIcIGRAASWHl-4LSsAAJi9AL8PsUABJY2917.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s100x75c4/g4/M02/08/0F/Cg-4WlGwGIeIOIWRAANMrMcXPpwAAJi9AMdJPAAA0zE682.jpg',
    'http://i1.bbs.fd.zol-img.com.cn/t_s100x75c4/g5/M00/06/03/ChMkJlgW98yIAvUPABR70e9wXMoAAXV4AL1vuEAFHvp141.jpg',
    'http://i2.bbs.fd.zol-img.com.cn/t_s100x75c4/g5/M00/03/09/ChMkJ1ffe6OIVboSABWPrwnR8ykAAWLWgKCToIAFY_H802.jpg',
    'http://i0.bbs.fd.zol-img.com.cn/t_s100x75c4/g5/M00/03/09/ChMkJ1ffe6eIZDfbABltOoNBfb0AAWLWgKe3SsAGW1S310.jpg'
]

/*
    1.布局要求1:1还原
2.相册要求点击以后，加载下一张的时候出现loading效果，或者使用预加载技术。
3.左右按钮除了加点击之外，还要添加键盘事件（左右箭头）同时，也要添加鼠标滚轮上下滚动，切换下一张活上一张。
4.图片必须使用网络图片资源。图片不限，以健康，积极向上为主。
5.图片要求在框中自适应，如果宽度或高度超出一屏了，那最宽也就是一屏的宽度。
6.底部的显示缩略图，注意上面元素和内容变化。
7.数据要求使用json形式。


提升：
如果可以，请为图片添加上动画。（如效果图或预览地址那样）
如果可以，请为其他元素按照效果图添加动画。

*/
function $$(id) {
    return document.getElementById(id);
}

function Mytools(obj) {
    this.obj = obj;
}
Mytools.prototype.getClass = function (sClass) {
    if (this.obj.getElementsByClassName) {
        return this.obj.getElementsByClassName(sClass);
    } else {
        this.reg = new RegExp('\\b' + sClass + '\\b');
        this.arr = [];
        this.allClass = this.obj.getElementsByTagName('*');
        for (var i = 0; i < this.allClass.length; i++) {
            if (this.reg.test(this.allClass[i].className)) {
                this.arr.push(this.allClass[i])
            }
        }
        return this.arr;
    }
}

function $(obj) {
    return new Mytools(obj);
}

//获取元素
var p = $$('photo');
//var p = oPhoto;
p.imgBox = $(p).getClass('img_box')[0];
p.imgBox.img = p.imgBox.getElementsByTagName('img')[0];
p.next = $(p).getClass('next')[0];
p.prev = $(p).getClass('prev')[0];
p.loading = $(p).getClass('loading')[0];
p.now = 0;
p.timer = null;
p.isNext = true; //允许下一次点击
p.scrollNext = true //默认允许往下滚动一张


//下面小图部分
p.sm = {};
p.sm.btn = $(p).getClass('hide_btn')[0];
p.sm.span = p.sm.btn.getElementsByTagName('span')[0];
p.sm.prev = $(p).getClass('sm_prev')[0];
p.sm.next = $(p).getClass('sm_next')[0];
p.sm.div = $(p).getClass('sm_img_list')[0];
p.sm.box = $(p).getClass('sm_img_box')[0];
p.sm.ul = p.sm.div.getElementsByTagName('ul')[0];

p.imgBox.style.height = innerHeight - p.sm.box.offsetHeight - 50 + 'px';

//处理小图 - 创建N个li
for (var i = 0; i < sm_img.length; i++) {
    var oLi = document.createElement('li');
    oLi.innerHTML = '<i></i><img src="' + sm_img[i] + '">';
    oLi.i = i;
    oLi.onclick = function () {
        p.now = this.i;
        tabImg();
    }

    p.sm.ul.appendChild(oLi);
}
//重新计算ul的宽度
p.sm.ul.style.width = (oLi.offsetWidth + 18) * sm_img.length + 'px';
//重新获取li
p.sm.li = p.sm.ul.getElementsByTagName('li');
//处理第0张为当前项 （初始化第一张）
p.sm.li[0].className = 'active';

//预加载 函数
function nextLoad(n) {
    var oImg = new Image();
    oImg.src = big_img[n];
    oImg.onload = function () {
        p.imgBox.img.style = '';
        p.imgBox.img.src = oImg.src;
        
        //算图片比例 - w>g 横着的
        if(oImg.width > oImg.height){
//            alert('if');
            p.imgBox.img.style.width = '100%';
            if(p.imgBox.img.offsetHeight>p.imgBox.offsetHeight){
                p.imgBox.img.style.width = 'auto';
                p.imgBox.img.style.height = '100%';
            }
//            p.imgBox.img.style.top = (p.imgBox.offsetHeight - p.imgBox.img.offsetHeight) / 2 + 'px';
        }
        else{
//            alert('else');
            p.imgBox.img.style.height = '100%';
            if(p.imgBox.img.offsetWidth>p.imgBox.offsetWidth){
                p.imgBox.img.style.height = 'auto';
                p.imgBox.img.style.width = '100%';
            }
        }
        
        p.loading.style.display = 'none';
        p.isNext = true;
        clearInterval(p.timer);
        setTimeout(function () {
            p.imgBox.img.style.opacity = 1;
            p.imgBox.img.style.transition = '0.35s';
            p.scrollNext = true;
        }, 350)
    }
}

//处理 大图第一张
nextLoad(0);


//为 左右箭头 添加点击事件 （滚轴+键盘+页面元素）


function tabImg() {
    if (!p.isNext) return false;
    p.imgBox.img.style.opacity = 0;
    p.imgBox.img.style.transition = 'none';
    clearInterval(p.timer);
    p.timer = setTimeout(function () {
        p.loading.style.display = 'block';
    }, 300)
    p.isNext = false;
    nextLoad(p.now);
    for (var i = 0; i < p.sm.li.length; i++) {
        p.sm.li[i].className = '';
    }

    
    //算 当前元素的尺寸，可以容下几个小图
    var curPic = Math.round(p.sm.div.offsetWidth / (p.sm.li[0].offsetWidth + 18));
    var lastNum = curPic - 3;
    
    console.log(curPic,lastNum,p.now);
    
    //处理下面当前项 跟着动
    if (p.now >= 2 && p.now <= big_img.length - lastNum + 2) {
        p.sm.ul.style.left = -118 * (p.now - 2) + 'px';
    }
    
    
    
    

    p.sm.li[p.now].className = 'active';

}

document.onkeydown = function (ev) {
    var oEv = ev || event;
    switch (oEv.keyCode) {
        case 39:
            nextClick();
            break;
        case 37:
            prevClick();
            break;
    }
}

function nextClick() {
    p.now++;
    if (p.now == big_img.length) {
        p.now = big_img.length - 1;
        alert('到头了-右侧');
        return;
    }
    tabImg();
}
p.next.onclick = function () {
    nextClick();
}

function prevClick() {
    p.now--;
    if (p.now <= -1) {
        p.now = 0;
        alert('到头了');
        return;
    }
    tabImg();
}
p.prev.onclick = function () {
    prevClick();
}

function addWheel(obj, fn) {
    function wheel(ev) {
        var oEv = ev || window.event;
        var isDown = true;
        oEv.wheelDelta ? oEv.wheelDelta < 0 ? isDown = true : isDown = false : -oEv.detail < 0 ? isDown = true : isDown = false;

        fn(isDown);
        oEv.preventDefault && oEv.preventDefault();
        return false;
    }
    window.navigator.userAgent.toLowerCase().indexOf('firefox') != -1 ? obj.addEventListener('DOMMouseScroll', wheel) : obj.onmousewheel = wheel;
}

//给元素添加滚动
addWheel(p.imgBox, function (down) {
    if (!p.scrollNext) return false;
    p.scrollNext = false;
    if (down) {
        nextClick();
    } else {
        prevClick();
    }
})